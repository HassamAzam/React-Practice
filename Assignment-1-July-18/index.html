<!DOCTYPE html>
<html>
  <head>
    <title>JSON Identifier</title>
    <h1>Welcome to JSON Identifier</h1>
    <link rel="stylesheet" href="style.css" />
    <script>
      function jsonChecker(text) {
        try {
          JSON.parse(text);
          return true;
        } catch {
          return false;
        }
      }
      function displayPostResponse(response)
    {
      response
            .then((response) => {
              return response.json();
            })
            .then((jsonResponse) => {
              console.log(jsonResponse);
              let uniqueId = jsonResponse.data.id;
              document.getElementById(
                "responseBox"
              ).innerHTML = `Successfully added in DB with ID ${uniqueId}`;
              console.log("Unique ID:", uniqueId);
            })
            .catch(() => {
              document.getElementById("responseBox").innerHTML =
                "Some Error Encountered";
            });
        } 
    
      function sendData() {        //Fetch API - POST usage
        let input = document.getElementById("inputResponse").value;

        if (jsonChecker(input)) {
          let data = JSON.parse(input);

          let response = fetch(
            "https://dummy.restapiexample.com/api/v1/create",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(data),
            }
          );
          displayPostResponse(response);//sending the promise to the Display Data function

        }
        else {
          document.getElementById("responseBox").innerHTML =
            "This can't be converted into JSON.";
        }
      }
      function displayGetResponse(response)
      {
        response
            .then((data) => {
              console.log("After first then: ", data);
              return data.json();
            })
            .then((bodyData) => {
              console.log(bodyData);

              dataObj = {
                name: bodyData.data.employee_name,
                id: bodyData.data.id,
              };
              console.log(dataObj);
              document.getElementById("dataAgainstId").innerHTML =
                "Name: " + dataObj.name + " | Id: " + bodyData.data.id;
            })
            .catch((e) => {
              document.getElementById("responseBox").innerHTML =
                "Back-end issue";
              console.log(e);
            });
      }
      function searchID() {
        id = document.getElementById("inputData").value;
        id = Number(id);
        if (id) {
          let response;
          try {
            response = fetch(
              `https://dummy.restapiexample.com/api/v1/employee/${id}`
            );
          } catch (e) {
            console.log("Fetch Error", e);
          }
          displayGetResponse(response);
          
        } else {
          document.getElementById("responseBox").innerHTML =
            "Wrong format of ID";
        }
      }
    </script>
  </head>

  <body>
    <label>Please enter the id to be searched below</label>
    <br />
    <input id="inputData" />
    <br />

    <button onClick="searchID()">Search</button>
    <br /><br /><br />
    <div id="getData">
      <p id="dataAgainstId"></p>
    </div>
    <div id="responseBox" class="result"></div>
    <label id="dynamicLabel">Enter your JSON response</label>
    <br />
    <div class="container">
      <input id="inputResponse" />
    </div>

    <br />
    <br />
    <button onclick="sendData()">Submit</button>

    <br />
  </body>
</html>
